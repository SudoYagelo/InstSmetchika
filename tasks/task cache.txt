Задача: 	
Категоризация работ при гибком поиске в кэше
Проблема: 
При поиске материала в журнале сопоставлений система не использует существующее поле «Раздел» для фильтрации, что приводит к некорректному подбору работ для материалов, используемых в разных инженерных системах
Проблема:
Функционал гибкого поиска в журнале (4 уровня поиска по параметрам материала) уже реализован и работает. В журнале сопоставлений уже существует поле «Раздел», которое содержит категорию работ (например, "Слаботочные системы", "Отопление", "Водоснабжение" и т.д.). Однако система не использует это поле при поиске совпадений — поиск идет по всему журналу без учета раздела.
Один и тот же материал может использоваться в различных разделах с разными работами. Например:

Материал: "Фитинги латунные для PEX Ду20"
В Разделе "Отопление" → КВР "Монтаж фитингов латунных для ПЕКС" (код r02.10.02.245.000)
В Разделе "Системы водоснабжения и канализации" → КВР "Монтаж фитингов латунных для ПЕКС" (другой код КВР)

При текущей реализации система может подтянуть из журнала работу из неправильного раздела.

Решение:
Требуемая доработка:
Добавить предварительную фильтрацию по полю «Раздел» перед применением алгоритма гибкого поиска:

Сопоставление "Папка работ" и "Раздел":

Система должна связать значение из поля "Папка работ" (в форме обработки) с полем "Раздел" (в журнале сопоставлений)
Установить соответствие между названиями папок и разделов (если они различаются)


Предварительная фильтрация журнала:

ДО применения 4 уровней гибкого поиска система выполняет фильтрацию: отбирает из журнала только записи с Раздел = текущей "Папке работ"
Создает отфильтрованную выборку записей журнала для дальнейшего поиска


Применение существующих уровней поиска:

Система применяет 4 уровня гибкого поиска только к отфильтрованной выборке:

Уровень 1: НаименованиеПозиции | Завод | КодИзделия | ТипМарка
Уровень 2: НаименованиеПозиции | КодИзделия | ТипМарка
Уровень 3: НаименованиеПозиции | ТипМарка
Уровень 4: НаименованиеПозиции



Автоматическое заполнение "Раздел" при добавлении в журнал:

При добавлении новой записи в журнал система должна автоматически заполнять поле "Раздел" значением из текущей "Папки работ"
Если это еще не реализовано, необходимо добавить эту логику

Алгоритм работы:
1. Определить текущую "Папку работ" (например, "Отопление")
2. Отфильтровать журнал: выбрать записи где Раздел = "Отопление"
3. В отфильтрованной выборке искать материал по 4 уровням
4. Если найдено совпадение → использовать
5. Если не найдено → отправить запрос к ИИ

Пример работы:


Текущая "Папка работ": "Отопление"

Материал: "Фитинги латунные для PEX Ду20"
Шаг 1: Система отфильтровывает журнал → оставляет только записи с Раздел = "Отопление"
Шаг 2: В отфильтрованной выборке ищет по 4 уровням
Результат: КВР "Монтаж фитингов латунных для ПЕКС" из раздела "Отопление"

Результат: Гибкий поиск в журнале работает только в пределах нужного раздела (категории работ), что обеспечивает корректный подбор КВР для материалов, используемых в разных инженерных системах, и предотвращает ошибки сопоставления.