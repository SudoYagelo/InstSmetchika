
Функция ПравилаПапки(КВР) Экспорт
	
	Запрос = Новый Запрос; 
	Запрос.УстановитьПараметр("Ссылка", КВР);
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	гк_КлассификаторВидовРабот.НастройкиПромпта КАК НастройкиПромпта
	|ИЗ
	|	Справочник.гк_КлассификаторВидовРабот КАК гк_КлассификаторВидовРабот
	|ГДЕ
	|	гк_КлассификаторВидовРабот.Ссылка = &Ссылка";
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Следующий() Тогда
		Возврат Выборка.НастройкиПромпта;
	Иначе
		Возврат "";
	КонецЕсли;
	
КонецФункции

Функция ШаблонЗапроса() Экспорт
	
	ТекстЗапроса =	"Проанализируй позиции спецификаций инженерных систем.
		|
		|ПОЗИЦИИ СПЕЦИФИКАЦИЙ:
		|%1
		|
		|ДОСТУПНЫЕ РАБОТЫ:
		|%2
		|
		|ЗАДАЧА: Определи одну наиболее подходящую работу для данной позиции. 
		|
		|ПРАВИЛА АНАЛИЗА:
		|%3
		|
		|ФОРМАТ ОТВЕТА (строго JSON):
		|{
		|  ""results"": [
		|    {
		|		""PositionName"": ""НаименованиеПозиции"",
		|		""TypeMark"": ""ТипМарка"",
		|		""UnitOfMeasurement"": ""ЕдиницаИзмерения"",
		|		""Factory"": ""Завод"",
		|		""ProductCode"": ""КодИзделия"",
		|		""work"": ""точное название работы из списка"",
		|		""consumables"": да или нет,
		|		""confidence"": число от 0 до 1
		|    }
		|  ]
		|}
		|
		|Confidence: 1.0 - полное соответствие, 0.8-0.9 - высокая уверенность, 0.5-0.7 - средняя, менее 0.5 - низкая";
	
	Возврат ТекстЗапроса;
	
КонецФункции